USE DATABASE [dev-westus-v1];

DECLARE EXTERNAL @SliceStart = "20131201";
DECLARE EXTERNAL @SliceEnd = "20180430";
DECLARE @SliceStartDate = DateTime.ParseExact(@SliceStart, "yyyyMMdd", null);
DECLARE @SliceEndDate = DateTime.ParseExact(@SliceEnd, "yyyyMMdd", null);

DECLARE @inputFileTrainingLabels string = "/training-labels-v2/CleanedForecastsNWAC_CAIC_UAC.V1.csv";
DECLARE @regionFilter string = @"/regions-v1/TrainingRegions.csv";

DECLARE EXTERNAL @Debug bool = false;

@trainingRegions =
    EXTRACT Country string,
            Center string,
            Region string,
            LatMin double,
            LatMax double,
            LonMin double,
            LonMax double 
    FROM @regionFilter
    USING Extractors.Csv(skipFirstNRows : 1);

@trainingLabels =
    EXTRACT 
        Cornices_Likelihood string,
        Cornices_MaximumSize string,
        Cornices_MinimumSize string,
        Cornices_OctagonAboveTreelineEast string,
        Cornices_OctagonAboveTreelineNorth string,
        Cornices_OctagonAboveTreelineNorthEast string,
        Cornices_OctagonAboveTreelineNorthWest string,
        Cornices_OctagonAboveTreelineSouth string,
        Cornices_OctagonAboveTreelineSouthEast string,
        Cornices_OctagonAboveTreelineSouthWest string,
        Cornices_OctagonAboveTreelineWest string,
        Cornices_OctagonBelowTreelineEast string,
        Cornices_OctagonBelowTreelineNorth string,
        Cornices_OctagonBelowTreelineNorthEast string,
        Cornices_OctagonBelowTreelineNorthWest string,
        Cornices_OctagonBelowTreelineSouth string,
        Cornices_OctagonBelowTreelineSouthEast string,
        Cornices_OctagonBelowTreelineSouthWest string,
        Cornices_OctagonBelowTreelineWest string,
        Cornices_OctagonNearTreelineEast string,
        Cornices_OctagonNearTreelineNorth string,
        Cornices_OctagonNearTreelineNorthEast string,
        Cornices_OctagonNearTreelineNorthWest string,
        Cornices_OctagonNearTreelineSouth string,
        Cornices_OctagonNearTreelineSouthEast string,
        Cornices_OctagonNearTreelineSouthWest string,
        Cornices_OctagonNearTreelineWest string,
        Day1DangerAboveTreeline string,
        Day1DangerBelowTreeline string,
        Day1DangerNearTreeline string,
        Day1Danger_OctagonAboveTreelineEast string,
        Day1Danger_OctagonAboveTreelineNorth string,
        Day1Danger_OctagonAboveTreelineNorthEast string,
        Day1Danger_OctagonAboveTreelineNorthWest string,
        Day1Danger_OctagonAboveTreelineSouth string,
        Day1Danger_OctagonAboveTreelineSouthEast string,
        Day1Danger_OctagonAboveTreelineSouthWest string,
        Day1Danger_OctagonAboveTreelineWest string,
        Day1Danger_OctagonBelowTreelineEast string,
        Day1Danger_OctagonBelowTreelineNorth string,
        Day1Danger_OctagonBelowTreelineNorthEast string,
        Day1Danger_OctagonBelowTreelineNorthWest string,
        Day1Danger_OctagonBelowTreelineSouth string,
        Day1Danger_OctagonBelowTreelineSouthEast string,
        Day1Danger_OctagonBelowTreelineSouthWest string,
        Day1Danger_OctagonBelowTreelineWest string,
        Day1Danger_OctagonNearTreelineEast string,
        Day1Danger_OctagonNearTreelineNorth string,
        Day1Danger_OctagonNearTreelineNorthEast string,
        Day1Danger_OctagonNearTreelineNorthWest string,
        Day1Danger_OctagonNearTreelineSouth string,
        Day1Danger_OctagonNearTreelineSouthEast string,
        Day1Danger_OctagonNearTreelineSouthWest string,
        Day1Danger_OctagonNearTreelineWest string,
        Day1DateString string,
        Day1DetailedForecast string,
        Day1Warning string,
        Day1WarningEndString string,
        Day2DangerAboveTreeline string,
        Day2DangerBelowTreeline string,
        Day2DangerNearTreeline string,
        Day2DetailedForecast string,
        Day2Warning string,
        Day2WarningEndString string,
        DeepPersistentSlab_Likelihood string,
        DeepPersistentSlab_MaximumSize string,
        DeepPersistentSlab_MinimumSize string,
        DeepPersistentSlab_OctagonAboveTreelineEast string,
        DeepPersistentSlab_OctagonAboveTreelineNorth string,
        DeepPersistentSlab_OctagonAboveTreelineNorthEast string,
        DeepPersistentSlab_OctagonAboveTreelineNorthWest string,
        DeepPersistentSlab_OctagonAboveTreelineSouth string,
        DeepPersistentSlab_OctagonAboveTreelineSouthEast string,
        DeepPersistentSlab_OctagonAboveTreelineSouthWest string,
        DeepPersistentSlab_OctagonAboveTreelineWest string,
        DeepPersistentSlab_OctagonBelowTreelineEast string,
        DeepPersistentSlab_OctagonBelowTreelineNorth string,
        DeepPersistentSlab_OctagonBelowTreelineNorthEast string,
        DeepPersistentSlab_OctagonBelowTreelineNorthWest string,
        DeepPersistentSlab_OctagonBelowTreelineSouth string,
        DeepPersistentSlab_OctagonBelowTreelineSouthEast string,
        DeepPersistentSlab_OctagonBelowTreelineSouthWest string,
        DeepPersistentSlab_OctagonBelowTreelineWest string,
        DeepPersistentSlab_OctagonNearTreelineEast string,
        DeepPersistentSlab_OctagonNearTreelineNorth string,
        DeepPersistentSlab_OctagonNearTreelineNorthEast string,
        DeepPersistentSlab_OctagonNearTreelineNorthWest string,
        DeepPersistentSlab_OctagonNearTreelineSouth string,
        DeepPersistentSlab_OctagonNearTreelineSouthEast string,
        DeepPersistentSlab_OctagonNearTreelineSouthWest string,
        DeepPersistentSlab_OctagonNearTreelineWest string,
        ForecastUrl string,
        Glide_Likelihood string,
        Glide_MaximumSize string,
        Glide_MinimumSize string,
        Glide_OctagonAboveTreelineEast string,
        Glide_OctagonAboveTreelineNorth string,
        Glide_OctagonAboveTreelineNorthEast string,
        Glide_OctagonAboveTreelineNorthWest string,
        Glide_OctagonAboveTreelineSouth string,
        Glide_OctagonAboveTreelineSouthEast string,
        Glide_OctagonAboveTreelineSouthWest string,
        Glide_OctagonAboveTreelineWest string,
        Glide_OctagonBelowTreelineEast string,
        Glide_OctagonBelowTreelineNorth string,
        Glide_OctagonBelowTreelineNorthEast string,
        Glide_OctagonBelowTreelineNorthWest string,
        Glide_OctagonBelowTreelineSouth string,
        Glide_OctagonBelowTreelineSouthEast string,
        Glide_OctagonBelowTreelineSouthWest string,
        Glide_OctagonBelowTreelineWest string,
        Glide_OctagonNearTreelineEast string,
        Glide_OctagonNearTreelineNorth string,
        Glide_OctagonNearTreelineNorthEast string,
        Glide_OctagonNearTreelineNorthWest string,
        Glide_OctagonNearTreelineSouth string,
        Glide_OctagonNearTreelineSouthEast string,
        Glide_OctagonNearTreelineSouthWest string,
        Glide_OctagonNearTreelineWest string,
        IsCoastalSnowpack string,
        IsContenentalSnowpack string,
        LooseDry_Likelihood string,
        LooseDry_MaximumSize string,
        LooseDry_MinimumSize string,
        LooseDry_OctagonAboveTreelineEast string,
        LooseDry_OctagonAboveTreelineNorth string,
        LooseDry_OctagonAboveTreelineNorthEast string,
        LooseDry_OctagonAboveTreelineNorthWest string,
        LooseDry_OctagonAboveTreelineSouth string,
        LooseDry_OctagonAboveTreelineSouthEast string,
        LooseDry_OctagonAboveTreelineSouthWest string,
        LooseDry_OctagonAboveTreelineWest string,
        LooseDry_OctagonBelowTreelineEast string,
        LooseDry_OctagonBelowTreelineNorth string,
        LooseDry_OctagonBelowTreelineNorthEast string,
        LooseDry_OctagonBelowTreelineNorthWest string,
        LooseDry_OctagonBelowTreelineSouth string,
        LooseDry_OctagonBelowTreelineSouthEast string,
        LooseDry_OctagonBelowTreelineSouthWest string,
        LooseDry_OctagonBelowTreelineWest string,
        LooseDry_OctagonNearTreelineEast string,
        LooseDry_OctagonNearTreelineNorth string,
        LooseDry_OctagonNearTreelineNorthEast string,
        LooseDry_OctagonNearTreelineNorthWest string,
        LooseDry_OctagonNearTreelineSouth string,
        LooseDry_OctagonNearTreelineSouthEast string,
        LooseDry_OctagonNearTreelineSouthWest string,
        LooseDry_OctagonNearTreelineWest string,
        LooseWet_Likelihood string,
        LooseWet_MaximumSize string,
        LooseWet_MinimumSize string,
        LooseWet_OctagonAboveTreelineEast string,
        LooseWet_OctagonAboveTreelineNorth string,
        LooseWet_OctagonAboveTreelineNorthEast string,
        LooseWet_OctagonAboveTreelineNorthWest string,
        LooseWet_OctagonAboveTreelineSouth string,
        LooseWet_OctagonAboveTreelineSouthEast string,
        LooseWet_OctagonAboveTreelineSouthWest string,
        LooseWet_OctagonAboveTreelineWest string,
        LooseWet_OctagonBelowTreelineEast string,
        LooseWet_OctagonBelowTreelineNorth string,
        LooseWet_OctagonBelowTreelineNorthEast string,
        LooseWet_OctagonBelowTreelineNorthWest string,
        LooseWet_OctagonBelowTreelineSouth string,
        LooseWet_OctagonBelowTreelineSouthEast string,
        LooseWet_OctagonBelowTreelineSouthWest string,
        LooseWet_OctagonBelowTreelineWest string,
        LooseWet_OctagonNearTreelineEast string,
        LooseWet_OctagonNearTreelineNorth string,
        LooseWet_OctagonNearTreelineNorthEast string,
        LooseWet_OctagonNearTreelineNorthWest string,
        LooseWet_OctagonNearTreelineSouth string,
        LooseWet_OctagonNearTreelineSouthEast string,
        LooseWet_OctagonNearTreelineSouthWest string,
        LooseWet_OctagonNearTreelineWest string,
        PersistentSlab_Likelihood string,
        PersistentSlab_MaximumSize string,
        PersistentSlab_MinimumSize string,
        PersistentSlab_OctagonAboveTreelineEast string,
        PersistentSlab_OctagonAboveTreelineNorth string,
        PersistentSlab_OctagonAboveTreelineNorthEast string,
        PersistentSlab_OctagonAboveTreelineNorthWest string,
        PersistentSlab_OctagonAboveTreelineSouth string,
        PersistentSlab_OctagonAboveTreelineSouthEast string,
        PersistentSlab_OctagonAboveTreelineSouthWest string,
        PersistentSlab_OctagonAboveTreelineWest string,
        PersistentSlab_OctagonBelowTreelineEast string,
        PersistentSlab_OctagonBelowTreelineNorth string,
        PersistentSlab_OctagonBelowTreelineNorthEast string,
        PersistentSlab_OctagonBelowTreelineNorthWest string,
        PersistentSlab_OctagonBelowTreelineSouth string,
        PersistentSlab_OctagonBelowTreelineSouthEast string,
        PersistentSlab_OctagonBelowTreelineSouthWest string,
        PersistentSlab_OctagonBelowTreelineWest string,
        PersistentSlab_OctagonNearTreelineEast string,
        PersistentSlab_OctagonNearTreelineNorth string,
        PersistentSlab_OctagonNearTreelineNorthEast string,
        PersistentSlab_OctagonNearTreelineNorthWest string,
        PersistentSlab_OctagonNearTreelineSouth string,
        PersistentSlab_OctagonNearTreelineSouthEast string,
        PersistentSlab_OctagonNearTreelineSouthWest string,
        PersistentSlab_OctagonNearTreelineWest string,
        PublishedDateTimeString string,
        Region string,
        SpecialStatement string,
        StormSlabs_Likelihood string,
        StormSlabs_MaximumSize string,
        StormSlabs_MinimumSize string,
        StormSlabs_OctagonAboveTreelineEast string,
        StormSlabs_OctagonAboveTreelineNorth string,
        StormSlabs_OctagonAboveTreelineNorthEast string,
        StormSlabs_OctagonAboveTreelineNorthWest string,
        StormSlabs_OctagonAboveTreelineSouth string,
        StormSlabs_OctagonAboveTreelineSouthEast string,
        StormSlabs_OctagonAboveTreelineSouthWest string,
        StormSlabs_OctagonAboveTreelineWest string,
        StormSlabs_OctagonBelowTreelineEast string,
        StormSlabs_OctagonBelowTreelineNorth string,
        StormSlabs_OctagonBelowTreelineNorthEast string,
        StormSlabs_OctagonBelowTreelineNorthWest string,
        StormSlabs_OctagonBelowTreelineSouth string,
        StormSlabs_OctagonBelowTreelineSouthEast string,
        StormSlabs_OctagonBelowTreelineSouthWest string,
        StormSlabs_OctagonBelowTreelineWest string,
        StormSlabs_OctagonNearTreelineEast string,
        StormSlabs_OctagonNearTreelineNorth string,
        StormSlabs_OctagonNearTreelineNorthEast string,
        StormSlabs_OctagonNearTreelineNorthWest string,
        StormSlabs_OctagonNearTreelineSouth string,
        StormSlabs_OctagonNearTreelineSouthEast string,
        StormSlabs_OctagonNearTreelineSouthWest string,
        StormSlabs_OctagonNearTreelineWest string,
        UnifiedRegion string,
        WetSlabs_Likelihood string,
        WetSlabs_MaximumSize string,
        WetSlabs_MinimumSize string,
        WetSlabs_OctagonAboveTreelineEast string,
        WetSlabs_OctagonAboveTreelineNorth string,
        WetSlabs_OctagonAboveTreelineNorthEast string,
        WetSlabs_OctagonAboveTreelineNorthWest string,
        WetSlabs_OctagonAboveTreelineSouth string,
        WetSlabs_OctagonAboveTreelineSouthEast string,
        WetSlabs_OctagonAboveTreelineSouthWest string,
        WetSlabs_OctagonAboveTreelineWest string,
        WetSlabs_OctagonBelowTreelineEast string,
        WetSlabs_OctagonBelowTreelineNorth string,
        WetSlabs_OctagonBelowTreelineNorthEast string,
        WetSlabs_OctagonBelowTreelineNorthWest string,
        WetSlabs_OctagonBelowTreelineSouth string,
        WetSlabs_OctagonBelowTreelineSouthEast string,
        WetSlabs_OctagonBelowTreelineSouthWest string,
        WetSlabs_OctagonBelowTreelineWest string,
        WetSlabs_OctagonNearTreelineEast string,
        WetSlabs_OctagonNearTreelineNorth string,
        WetSlabs_OctagonNearTreelineNorthEast string,
        WetSlabs_OctagonNearTreelineNorthWest string,
        WetSlabs_OctagonNearTreelineSouth string,
        WetSlabs_OctagonNearTreelineSouthEast string,
        WetSlabs_OctagonNearTreelineSouthWest string,
        WetSlabs_OctagonNearTreelineWest string,
        WindSlab_Likelihood string,
        WindSlab_MaximumSize string,
        WindSlab_MinimumSize string,
        WindSlab_OctagonAboveTreelineEast string,
        WindSlab_OctagonAboveTreelineNorth string,
        WindSlab_OctagonAboveTreelineNorthEast string,
        WindSlab_OctagonAboveTreelineNorthWest string,
        WindSlab_OctagonAboveTreelineSouth string,
        WindSlab_OctagonAboveTreelineSouthEast string,
        WindSlab_OctagonAboveTreelineSouthWest string,
        WindSlab_OctagonAboveTreelineWest string,
        WindSlab_OctagonBelowTreelineEast string,
        WindSlab_OctagonBelowTreelineNorth string,
        WindSlab_OctagonBelowTreelineNorthEast string,
        WindSlab_OctagonBelowTreelineNorthWest string,
        WindSlab_OctagonBelowTreelineSouth string,
        WindSlab_OctagonBelowTreelineSouthEast string,
        WindSlab_OctagonBelowTreelineSouthWest string,
        WindSlab_OctagonBelowTreelineWest string,
        WindSlab_OctagonNearTreelineEast string,
        WindSlab_OctagonNearTreelineNorth string,
        WindSlab_OctagonNearTreelineNorthEast string,
        WindSlab_OctagonNearTreelineNorthWest string,
        WindSlab_OctagonNearTreelineSouth string,
        WindSlab_OctagonNearTreelineSouthEast string,
        WindSlab_OctagonNearTreelineSouthWest string,
        WindSlab_OctagonNearTreelineWest string,
        image_paths string,
        image_types string,
        image_urls string,
        rose_url string
    FROM @inputFileTrainingLabels 
    USING Extractors.Csv(skipFirstNRows : 1, silent: false, quoting : true);

@trainingLabels =
    SELECT 
        Region,
        UnifiedRegion,
        DateTime.ParseExact(PublishedDateTimeString, "yyyyMMdd HH:00", null) AS PublishedDateTime,
        DateTime.ParseExact(Day1DateString, "yyyyMMdd", null).Date AS Day1Date,
        SpecialStatement,
        ForecastUrl,
        Day1DangerAboveTreeline,
        Day1DangerNearTreeline,
        Day1DangerBelowTreeline,
        Day1DetailedForecast,
        Day1Warning,
        DateTime.ParseExact(Day1WarningEndString, "yyyyMMdd HH:00", null) AS Day1WarningEnd,
        Day2DangerAboveTreeline,
        Day2DangerNearTreeline,
        Day2DangerBelowTreeline,
        Day2DetailedForecast,
        Day2Warning,
        DateTime.ParseExact(Day2WarningEndString, "yyyyMMdd HH:00", null) AS Day2WarningEnd,
        Cornices_Likelihood,
        Cornices_MaximumSize,
        Cornices_MinimumSize,
        Cornices_OctagonAboveTreelineEast,
        Cornices_OctagonAboveTreelineNorth,
        Cornices_OctagonAboveTreelineNorthEast,
        Cornices_OctagonAboveTreelineNorthWest,
        Cornices_OctagonAboveTreelineSouth,
        Cornices_OctagonAboveTreelineSouthEast,
        Cornices_OctagonAboveTreelineSouthWest,
        Cornices_OctagonAboveTreelineWest,
        Cornices_OctagonNearTreelineEast,
        Cornices_OctagonNearTreelineNorth,
        Cornices_OctagonNearTreelineNorthEast,
        Cornices_OctagonNearTreelineNorthWest,
        Cornices_OctagonNearTreelineSouth,
        Cornices_OctagonNearTreelineSouthEast,
        Cornices_OctagonNearTreelineSouthWest,
        Cornices_OctagonNearTreelineWest,
        Cornices_OctagonBelowTreelineEast,
        Cornices_OctagonBelowTreelineNorth,
        Cornices_OctagonBelowTreelineNorthEast,
        Cornices_OctagonBelowTreelineNorthWest,
        Cornices_OctagonBelowTreelineSouth,
        Cornices_OctagonBelowTreelineSouthEast,
        Cornices_OctagonBelowTreelineSouthWest,
        Cornices_OctagonBelowTreelineWest,
        Glide_Likelihood,
        Glide_MaximumSize, 
        Glide_MinimumSize,
        Glide_OctagonAboveTreelineEast,
        Glide_OctagonAboveTreelineNorth,
        Glide_OctagonAboveTreelineNorthEast,
        Glide_OctagonAboveTreelineNorthWest,
        Glide_OctagonAboveTreelineSouth,
        Glide_OctagonAboveTreelineSouthEast,
        Glide_OctagonAboveTreelineSouthWest,
        Glide_OctagonAboveTreelineWest,
        Glide_OctagonNearTreelineEast,
        Glide_OctagonNearTreelineNorth,
        Glide_OctagonNearTreelineNorthEast,
        Glide_OctagonNearTreelineNorthWest,
        Glide_OctagonNearTreelineSouth,
        Glide_OctagonNearTreelineSouthEast,
        Glide_OctagonNearTreelineSouthWest,
        Glide_OctagonNearTreelineWest,
        Glide_OctagonBelowTreelineEast,
        Glide_OctagonBelowTreelineNorth,
        Glide_OctagonBelowTreelineNorthEast,
        Glide_OctagonBelowTreelineNorthWest,
        Glide_OctagonBelowTreelineSouth,
        Glide_OctagonBelowTreelineSouthEast,
        Glide_OctagonBelowTreelineSouthWest,
        Glide_OctagonBelowTreelineWest,
        LooseDry_Likelihood,
        LooseDry_MaximumSize,
        LooseDry_MinimumSize,
        LooseDry_OctagonAboveTreelineEast,
        LooseDry_OctagonAboveTreelineNorth,
        LooseDry_OctagonAboveTreelineNorthEast,
        LooseDry_OctagonAboveTreelineNorthWest,
        LooseDry_OctagonAboveTreelineSouth,
        LooseDry_OctagonAboveTreelineSouthEast,
        LooseDry_OctagonAboveTreelineSouthWest,
        LooseDry_OctagonAboveTreelineWest,
        LooseDry_OctagonNearTreelineEast,
        LooseDry_OctagonNearTreelineNorth,
        LooseDry_OctagonNearTreelineNorthEast,
        LooseDry_OctagonNearTreelineNorthWest,
        LooseDry_OctagonNearTreelineSouth,
        LooseDry_OctagonNearTreelineSouthEast,
        LooseDry_OctagonNearTreelineSouthWest,
        LooseDry_OctagonNearTreelineWest,
        LooseDry_OctagonBelowTreelineEast,
        LooseDry_OctagonBelowTreelineNorth,
        LooseDry_OctagonBelowTreelineNorthEast,
        LooseDry_OctagonBelowTreelineNorthWest,
        LooseDry_OctagonBelowTreelineSouth,
        LooseDry_OctagonBelowTreelineSouthEast,
        LooseDry_OctagonBelowTreelineSouthWest,
        LooseDry_OctagonBelowTreelineWest,
        LooseWet_Likelihood,
        LooseWet_MaximumSize,
        LooseWet_MinimumSize,
        LooseWet_OctagonAboveTreelineEast,
        LooseWet_OctagonAboveTreelineNorth,
        LooseWet_OctagonAboveTreelineNorthEast,
        LooseWet_OctagonAboveTreelineNorthWest,
        LooseWet_OctagonAboveTreelineSouth,
        LooseWet_OctagonAboveTreelineSouthEast,
        LooseWet_OctagonAboveTreelineSouthWest,
        LooseWet_OctagonAboveTreelineWest,
        LooseWet_OctagonNearTreelineEast,
        LooseWet_OctagonNearTreelineNorth,
        LooseWet_OctagonNearTreelineNorthEast,
        LooseWet_OctagonNearTreelineNorthWest,
        LooseWet_OctagonNearTreelineSouth,
        LooseWet_OctagonNearTreelineSouthEast,
        LooseWet_OctagonNearTreelineSouthWest,
        LooseWet_OctagonNearTreelineWest,
        LooseWet_OctagonBelowTreelineEast,
        LooseWet_OctagonBelowTreelineNorth,
        LooseWet_OctagonBelowTreelineNorthEast,
        LooseWet_OctagonBelowTreelineNorthWest,
        LooseWet_OctagonBelowTreelineSouth,
        LooseWet_OctagonBelowTreelineSouthEast,
        LooseWet_OctagonBelowTreelineSouthWest,
        LooseWet_OctagonBelowTreelineWest,
        PersistentSlab_Likelihood,
        PersistentSlab_MaximumSize,
        PersistentSlab_MinimumSize,
        PersistentSlab_OctagonAboveTreelineEast,
        PersistentSlab_OctagonAboveTreelineNorth,
        PersistentSlab_OctagonAboveTreelineNorthEast,
        PersistentSlab_OctagonAboveTreelineNorthWest,
        PersistentSlab_OctagonAboveTreelineSouth,
        PersistentSlab_OctagonAboveTreelineSouthEast,
        PersistentSlab_OctagonAboveTreelineSouthWest,
        PersistentSlab_OctagonAboveTreelineWest,
        PersistentSlab_OctagonNearTreelineEast,
        PersistentSlab_OctagonNearTreelineNorth,
        PersistentSlab_OctagonNearTreelineNorthEast,
        PersistentSlab_OctagonNearTreelineNorthWest,
        PersistentSlab_OctagonNearTreelineSouth,
        PersistentSlab_OctagonNearTreelineSouthEast,
        PersistentSlab_OctagonNearTreelineSouthWest,
        PersistentSlab_OctagonNearTreelineWest,
        PersistentSlab_OctagonBelowTreelineEast,
        PersistentSlab_OctagonBelowTreelineNorth,
        PersistentSlab_OctagonBelowTreelineNorthEast,
        PersistentSlab_OctagonBelowTreelineNorthWest,
        PersistentSlab_OctagonBelowTreelineSouth,
        PersistentSlab_OctagonBelowTreelineSouthEast,
        PersistentSlab_OctagonBelowTreelineSouthWest,
        PersistentSlab_OctagonBelowTreelineWest,
        DeepPersistentSlab_Likelihood,
        DeepPersistentSlab_MaximumSize,
        DeepPersistentSlab_MinimumSize,
        DeepPersistentSlab_OctagonAboveTreelineEast,
        DeepPersistentSlab_OctagonAboveTreelineNorth,
        DeepPersistentSlab_OctagonAboveTreelineNorthEast,
        DeepPersistentSlab_OctagonAboveTreelineNorthWest,
        DeepPersistentSlab_OctagonAboveTreelineSouth,
        DeepPersistentSlab_OctagonAboveTreelineSouthEast,
        DeepPersistentSlab_OctagonAboveTreelineSouthWest,
        DeepPersistentSlab_OctagonAboveTreelineWest,
        DeepPersistentSlab_OctagonNearTreelineEast,
        DeepPersistentSlab_OctagonNearTreelineNorth,
        DeepPersistentSlab_OctagonNearTreelineNorthEast,
        DeepPersistentSlab_OctagonNearTreelineNorthWest,
        DeepPersistentSlab_OctagonNearTreelineSouth,
        DeepPersistentSlab_OctagonNearTreelineSouthEast,
        DeepPersistentSlab_OctagonNearTreelineSouthWest,
        DeepPersistentSlab_OctagonNearTreelineWest,
        DeepPersistentSlab_OctagonBelowTreelineEast,
        DeepPersistentSlab_OctagonBelowTreelineNorth,
        DeepPersistentSlab_OctagonBelowTreelineNorthEast,
        DeepPersistentSlab_OctagonBelowTreelineNorthWest,
        DeepPersistentSlab_OctagonBelowTreelineSouth,
        DeepPersistentSlab_OctagonBelowTreelineSouthEast,
        DeepPersistentSlab_OctagonBelowTreelineSouthWest,
        DeepPersistentSlab_OctagonBelowTreelineWest,
        StormSlabs_Likelihood, 
        StormSlabs_MaximumSize,
        StormSlabs_MinimumSize,
        StormSlabs_OctagonAboveTreelineEast,
        StormSlabs_OctagonAboveTreelineNorth,
        StormSlabs_OctagonAboveTreelineNorthEast,
        StormSlabs_OctagonAboveTreelineNorthWest,
        StormSlabs_OctagonAboveTreelineSouth,
        StormSlabs_OctagonAboveTreelineSouthEast,
        StormSlabs_OctagonAboveTreelineSouthWest,
        StormSlabs_OctagonAboveTreelineWest,
        StormSlabs_OctagonNearTreelineEast, 
        StormSlabs_OctagonNearTreelineNorth,
        StormSlabs_OctagonNearTreelineNorthEast,
        StormSlabs_OctagonNearTreelineNorthWest,
        StormSlabs_OctagonNearTreelineSouth,
        StormSlabs_OctagonNearTreelineSouthEast,
        StormSlabs_OctagonNearTreelineSouthWest,
        StormSlabs_OctagonNearTreelineWest,
        StormSlabs_OctagonBelowTreelineEast,
        StormSlabs_OctagonBelowTreelineNorth,
        StormSlabs_OctagonBelowTreelineNorthEast,
        StormSlabs_OctagonBelowTreelineNorthWest,
        StormSlabs_OctagonBelowTreelineSouth,
        StormSlabs_OctagonBelowTreelineSouthEast,
        StormSlabs_OctagonBelowTreelineSouthWest,
        StormSlabs_OctagonBelowTreelineWest,
        WetSlabs_Likelihood,
        WetSlabs_MaximumSize,
        WetSlabs_MinimumSize,
        WetSlabs_OctagonAboveTreelineEast,
        WetSlabs_OctagonAboveTreelineNorth,
        WetSlabs_OctagonAboveTreelineNorthEast,
        WetSlabs_OctagonAboveTreelineNorthWest,
        WetSlabs_OctagonAboveTreelineSouth,
        WetSlabs_OctagonAboveTreelineSouthEast,
        WetSlabs_OctagonAboveTreelineSouthWest,
        WetSlabs_OctagonAboveTreelineWest,
        WetSlabs_OctagonNearTreelineEast,
        WetSlabs_OctagonNearTreelineNorth,
        WetSlabs_OctagonNearTreelineNorthEast,
        WetSlabs_OctagonNearTreelineNorthWest,
        WetSlabs_OctagonNearTreelineSouth,
        WetSlabs_OctagonNearTreelineSouthEast,
        WetSlabs_OctagonNearTreelineSouthWest,
        WetSlabs_OctagonNearTreelineWest,
        WetSlabs_OctagonBelowTreelineEast,
        WetSlabs_OctagonBelowTreelineNorth,
        WetSlabs_OctagonBelowTreelineNorthEast,
        WetSlabs_OctagonBelowTreelineNorthWest,
        WetSlabs_OctagonBelowTreelineSouth,
        WetSlabs_OctagonBelowTreelineSouthEast,
        WetSlabs_OctagonBelowTreelineSouthWest,
        WetSlabs_OctagonBelowTreelineWest,
        WindSlab_Likelihood,
        WindSlab_MaximumSize,
        WindSlab_MinimumSize,
        WindSlab_OctagonAboveTreelineEast,
        WindSlab_OctagonAboveTreelineNorth,
        WindSlab_OctagonAboveTreelineNorthEast,
        WindSlab_OctagonAboveTreelineNorthWest,
        WindSlab_OctagonAboveTreelineSouth,
        WindSlab_OctagonAboveTreelineSouthEast,
        WindSlab_OctagonAboveTreelineSouthWest,
        WindSlab_OctagonAboveTreelineWest,
        WindSlab_OctagonNearTreelineEast,
        WindSlab_OctagonNearTreelineNorth,
        WindSlab_OctagonNearTreelineNorthEast,
        WindSlab_OctagonNearTreelineNorthWest,
        WindSlab_OctagonNearTreelineSouth,
        WindSlab_OctagonNearTreelineSouthEast,
        WindSlab_OctagonNearTreelineSouthWest,
        WindSlab_OctagonNearTreelineWest,
        WindSlab_OctagonBelowTreelineEast,
        WindSlab_OctagonBelowTreelineNorth,
        WindSlab_OctagonBelowTreelineNorthEast,
        WindSlab_OctagonBelowTreelineNorthWest,
        WindSlab_OctagonBelowTreelineSouth,
        WindSlab_OctagonBelowTreelineSouthEast,
        WindSlab_OctagonBelowTreelineSouthWest,
        WindSlab_OctagonBelowTreelineWest,
        IsCoastalSnowpack,
        IsContenentalSnowpack
    FROM @trainingLabels
    WHERE DateTime.ParseExact(Day1DateString, "yyyyMMdd", null) BETWEEN @SliceStartDate AND @SliceEndDate;


@trainingData = 
    SELECT 
        *,
        [Date].Date AS JoinDate
    FROM dbo.[USWestFullInputFeatures30DaysV1.1] 
    WHERE [Date] BETWEEN @SliceStartDate AND @SliceEndDate;

@trainingData =
    SELECT 
        d.*,
        r.Region     
    FROM @trainingData AS d
    CROSS JOIN
        @trainingRegions AS r
    WHERE (d.Lat BETWEEN r.LatMin AND r.LatMax)
          AND (d.Lon BETWEEN r.LonMin AND r.LonMax);

IF(@Debug) THEN
    OUTPUT @trainingData
    TO @"/debug-out/trainingwithregions.csv"
    ORDER BY [Date] DESC
    USING Outputters.Csv(quoting : false, dateTimeFormat : null, outputHeader : true);

    OUTPUT @trainingLabels
    TO @"/debug-out/labels.csv"
    ORDER BY [Day1Date] DESC
    USING Outputters.Csv(quoting : false, dateTimeFormat : null, outputHeader : true);
END;

@joinedData = 
    SELECT DISTINCT //we need to do distinct as we remove labelRegion in this step and we want to collapse duplicate unifiedregions which might have occured
        d.*,
        UnifiedRegion,
        PublishedDateTime,
        Day1Date,
        SpecialStatement AS t_SpecialStatement,
        ForecastUrl AS m_ForecastUrl,
        Day1DangerAboveTreeline AS o_Day1DangerAboveTreeline,
        Day1DangerNearTreeline AS o_Day1DangerNearTreeline,
        Day1DangerBelowTreeline AS o_Day1DangerBelowTreeline,
        Day1DetailedForecast AS o_Day1DetailedForecast,
        Day1Warning AS o_Day1Warning,
        Day1WarningEnd AS o_Day1WarningEnd,
        Day2DangerAboveTreeline AS o_Day2DangerAboveTreeline,
        Day2DangerNearTreeline AS o_Day2DangerNearTreeline,
        Day2DangerBelowTreeline AS o_Day2DangerBelowTreeline,
        Day2DetailedForecast AS o_Day2DetailedForecast,
        Day2Warning AS o_Day2Warning,
        Day2WarningEnd AS o_Day2WarningEnd,
        Cornices_Likelihood AS o_Cornices_Likelihood,
        Cornices_MaximumSize AS o_Cornices_MaximumSize,
        Cornices_MinimumSize AS o_Cornices_MinimumSize,
        Cornices_OctagonAboveTreelineEast AS o_Cornices_OctagonAboveTreelineEast,
        Cornices_OctagonAboveTreelineNorth AS o_Cornices_OctagonAboveTreelineNorth,
        Cornices_OctagonAboveTreelineNorthEast AS o_Cornices_OctagonAboveTreelineNorthEast,
        Cornices_OctagonAboveTreelineNorthWest AS o_Cornices_OctagonAboveTreelineNorthWest,
        Cornices_OctagonAboveTreelineSouth AS o_Cornices_OctagonAboveTreelineSouth,
        Cornices_OctagonAboveTreelineSouthEast AS o_Cornices_OctagonAboveTreelineSouthEast,
        Cornices_OctagonAboveTreelineSouthWest AS o_Cornices_OctagonAboveTreelineSouthWest,
        Cornices_OctagonAboveTreelineWest AS o_Cornices_OctagonAboveTreelineWest,
        Cornices_OctagonNearTreelineEast AS o_Cornices_OctagonNearTreelineEast,
        Cornices_OctagonNearTreelineNorth AS o_Cornices_OctagonNearTreelineNorth,
        Cornices_OctagonNearTreelineNorthEast AS o_Cornices_OctagonNearTreelineNorthEast,
        Cornices_OctagonNearTreelineNorthWest AS o_Cornices_OctagonNearTreelineNorthWest,
        Cornices_OctagonNearTreelineSouth AS o_Cornices_OctagonNearTreelineSouth,
        Cornices_OctagonNearTreelineSouthEast AS o_Cornices_OctagonNearTreelineSouthEast,
        Cornices_OctagonNearTreelineSouthWest AS o_Cornices_OctagonNearTreelineSouthWest,
        Cornices_OctagonNearTreelineWest AS o_Cornices_OctagonNearTreelineWest,
        Cornices_OctagonBelowTreelineEast AS o_Cornices_OctagonBelowTreelineEast,
        Cornices_OctagonBelowTreelineNorth AS o_Cornices_OctagonBelowTreelineNorth,
        Cornices_OctagonBelowTreelineNorthEast AS o_Cornices_OctagonBelowTreelineNorthEast,
        Cornices_OctagonBelowTreelineNorthWest AS o_Cornices_OctagonBelowTreelineNorthWest,
        Cornices_OctagonBelowTreelineSouth AS o_Cornices_OctagonBelowTreelineSouth,
        Cornices_OctagonBelowTreelineSouthEast AS o_Cornices_OctagonBelowTreelineSouthEast,
        Cornices_OctagonBelowTreelineSouthWest AS o_Cornices_OctagonBelowTreelineSouthWest,
        Cornices_OctagonBelowTreelineWest AS o_Cornices_OctagonBelowTreelineWest,
        Glide_Likelihood AS o_Glide_Likelihood,
        Glide_MaximumSize AS o_Glide_MaximumSize,
        Glide_MinimumSize AS o_Glide_MinimumSize,
        Glide_OctagonAboveTreelineEast AS o_Glide_OctagonAboveTreelineEast,
        Glide_OctagonAboveTreelineNorth AS o_Glide_OctagonAboveTreelineNorth,
        Glide_OctagonAboveTreelineNorthEast AS o_Glide_OctagonAboveTreelineNorthEast,
        Glide_OctagonAboveTreelineNorthWest AS o_Glide_OctagonAboveTreelineNorthWest,
        Glide_OctagonAboveTreelineSouth AS o_Glide_OctagonAboveTreelineSouth,
        Glide_OctagonAboveTreelineSouthEast AS o_Glide_OctagonAboveTreelineSouthEast,
        Glide_OctagonAboveTreelineSouthWest AS o_Glide_OctagonAboveTreelineSouthWest,
        Glide_OctagonAboveTreelineWest AS o_Glide_OctagonAboveTreelineWest,
        Glide_OctagonNearTreelineEast AS o_Glide_OctagonNearTreelineEast,
        Glide_OctagonNearTreelineNorth AS o_Glide_OctagonNearTreelineNorth,
        Glide_OctagonNearTreelineNorthEast AS o_Glide_OctagonNearTreelineNorthEast,
        Glide_OctagonNearTreelineNorthWest AS o_Glide_OctagonNearTreelineNorthWest,
        Glide_OctagonNearTreelineSouth AS o_Glide_OctagonNearTreelineSouth,
        Glide_OctagonNearTreelineSouthEast AS o_Glide_OctagonNearTreelineSouthEast,
        Glide_OctagonNearTreelineSouthWest AS o_Glide_OctagonNearTreelineSouthWest,
        Glide_OctagonNearTreelineWest AS o_Glide_OctagonNearTreelineWest,
        Glide_OctagonBelowTreelineEast AS o_Glide_OctagonBelowTreelineEast,
        Glide_OctagonBelowTreelineNorth AS o_Glide_OctagonBelowTreelineNorth,
        Glide_OctagonBelowTreelineNorthEast AS o_Glide_OctagonBelowTreelineNorthEast,
        Glide_OctagonBelowTreelineNorthWest AS o_Glide_OctagonBelowTreelineNorthWest,
        Glide_OctagonBelowTreelineSouth AS o_Glide_OctagonBelowTreelineSouth,
        Glide_OctagonBelowTreelineSouthEast AS o_Glide_OctagonBelowTreelineSouthEast,
        Glide_OctagonBelowTreelineSouthWest AS o_Glide_OctagonBelowTreelineSouthWest,
        Glide_OctagonBelowTreelineWest AS o_Glide_OctagonBelowTreelineWest,
        LooseDry_Likelihood AS o_LooseDry_Likelihood,
        LooseDry_MaximumSize AS o_LooseDry_MaximumSize,
        LooseDry_MinimumSize AS o_LooseDry_MinimumSize,
        LooseDry_OctagonAboveTreelineEast AS o_LooseDry_OctagonAboveTreelineEast,
        LooseDry_OctagonAboveTreelineNorth AS o_LooseDry_OctagonAboveTreelineNorth,
        LooseDry_OctagonAboveTreelineNorthEast AS o_LooseDry_OctagonAboveTreelineNorthEast,
        LooseDry_OctagonAboveTreelineNorthWest AS o_LooseDry_OctagonAboveTreelineNorthWest,
        LooseDry_OctagonAboveTreelineSouth AS o_LooseDry_OctagonAboveTreelineSouth,
        LooseDry_OctagonAboveTreelineSouthEast AS o_LooseDry_OctagonAboveTreelineSouthEast,
        LooseDry_OctagonAboveTreelineSouthWest AS o_LooseDry_OctagonAboveTreelineSouthWest,
        LooseDry_OctagonAboveTreelineWest AS o_LooseDry_OctagonAboveTreelineWest,
        LooseDry_OctagonNearTreelineEast AS o_LooseDry_OctagonNearTreelineEast,
        LooseDry_OctagonNearTreelineNorth AS o_LooseDry_OctagonNearTreelineNorth,
        LooseDry_OctagonNearTreelineNorthEast AS o_LooseDry_OctagonNearTreelineNorthEast,
        LooseDry_OctagonNearTreelineNorthWest AS o_LooseDry_OctagonNearTreelineNorthWest,
        LooseDry_OctagonNearTreelineSouth AS o_LooseDry_OctagonNearTreelineSouth,
        LooseDry_OctagonNearTreelineSouthEast AS o_LooseDry_OctagonNearTreelineSouthEast,
        LooseDry_OctagonNearTreelineSouthWest AS o_LooseDry_OctagonNearTreelineSouthWest,
        LooseDry_OctagonNearTreelineWest AS o_LooseDry_OctagonNearTreelineWest,
        LooseDry_OctagonBelowTreelineEast AS o_LooseDry_OctagonBelowTreelineEast,
        LooseDry_OctagonBelowTreelineNorth AS o_LooseDry_OctagonBelowTreelineNorth,
        LooseDry_OctagonBelowTreelineNorthEast AS o_LooseDry_OctagonBelowTreelineNorthEast,
        LooseDry_OctagonBelowTreelineNorthWest AS o_LooseDry_OctagonBelowTreelineNorthWest,
        LooseDry_OctagonBelowTreelineSouth AS o_LooseDry_OctagonBelowTreelineSouth,
        LooseDry_OctagonBelowTreelineSouthEast AS o_LooseDry_OctagonBelowTreelineSouthEast,
        LooseDry_OctagonBelowTreelineSouthWest AS o_LooseDry_OctagonBelowTreelineSouthWest,
        LooseDry_OctagonBelowTreelineWest AS o_LooseDry_OctagonBelowTreelineWest,
        LooseWet_Likelihood AS o_LooseWet_Likelihood,
        LooseWet_MaximumSize AS o_LooseWet_MaximumSize,
        LooseWet_MinimumSize AS o_LooseWet_MinimumSize,
        LooseWet_OctagonAboveTreelineEast AS o_LooseWet_OctagonAboveTreelineEast,
        LooseWet_OctagonAboveTreelineNorth AS o_LooseWet_OctagonAboveTreelineNorth,
        LooseWet_OctagonAboveTreelineNorthEast AS o_LooseWet_OctagonAboveTreelineNorthEast,
        LooseWet_OctagonAboveTreelineNorthWest AS o_LooseWet_OctagonAboveTreelineNorthWest,
        LooseWet_OctagonAboveTreelineSouth AS o_LooseWet_OctagonAboveTreelineSouth,
        LooseWet_OctagonAboveTreelineSouthEast AS o_LooseWet_OctagonAboveTreelineSouthEast,
        LooseWet_OctagonAboveTreelineSouthWest AS o_LooseWet_OctagonAboveTreelineSouthWest,
        LooseWet_OctagonAboveTreelineWest AS o_LooseWet_OctagonAboveTreelineWest,
        LooseWet_OctagonNearTreelineEast AS o_LooseWet_OctagonNearTreelineEast,
        LooseWet_OctagonNearTreelineNorth AS o_LooseWet_OctagonNearTreelineNorth,
        LooseWet_OctagonNearTreelineNorthEast AS o_LooseWet_OctagonNearTreelineNorthEast,
        LooseWet_OctagonNearTreelineNorthWest AS o_LooseWet_OctagonNearTreelineNorthWest,
        LooseWet_OctagonNearTreelineSouth AS o_LooseWet_OctagonNearTreelineSouth,
        LooseWet_OctagonNearTreelineSouthEast AS o_LooseWet_OctagonNearTreelineSouthEast,
        LooseWet_OctagonNearTreelineSouthWest AS o_LooseWet_OctagonNearTreelineSouthWest,
        LooseWet_OctagonNearTreelineWest AS o_LooseWet_OctagonNearTreelineWest,
        LooseWet_OctagonBelowTreelineEast AS o_LooseWet_OctagonBelowTreelineEast,
        LooseWet_OctagonBelowTreelineNorth AS o_LooseWet_OctagonBelowTreelineNorth,
        LooseWet_OctagonBelowTreelineNorthEast AS o_LooseWet_OctagonBelowTreelineNorthEast,
        LooseWet_OctagonBelowTreelineNorthWest AS o_LooseWet_OctagonBelowTreelineNorthWest,
        LooseWet_OctagonBelowTreelineSouth AS o_LooseWet_OctagonBelowTreelineSouth,
        LooseWet_OctagonBelowTreelineSouthEast AS o_LooseWet_OctagonBelowTreelineSouthEast,
        LooseWet_OctagonBelowTreelineSouthWest AS o_LooseWet_OctagonBelowTreelineSouthWest,
        LooseWet_OctagonBelowTreelineWest AS o_LooseWet_OctagonBelowTreelineWest,
        PersistentSlab_Likelihood AS o_PersistentSlab_Likelihood,
        PersistentSlab_MaximumSize AS o_PersistentSlab_MaximumSize,
        PersistentSlab_MinimumSize AS o_PersistentSlab_MinimumSize,
        PersistentSlab_OctagonAboveTreelineEast AS o_PersistentSlab_OctagonAboveTreelineEast,
        PersistentSlab_OctagonAboveTreelineNorth AS o_PersistentSlab_OctagonAboveTreelineNorth,
        PersistentSlab_OctagonAboveTreelineNorthEast AS o_PersistentSlab_OctagonAboveTreelineNorthEast,
        PersistentSlab_OctagonAboveTreelineNorthWest AS o_PersistentSlab_OctagonAboveTreelineNorthWest,
        PersistentSlab_OctagonAboveTreelineSouth AS o_PersistentSlab_OctagonAboveTreelineSouth,
        PersistentSlab_OctagonAboveTreelineSouthEast AS o_PersistentSlab_OctagonAboveTreelineSouthEast,
        PersistentSlab_OctagonAboveTreelineSouthWest AS o_PersistentSlab_OctagonAboveTreelineSouthWest,
        PersistentSlab_OctagonAboveTreelineWest AS o_PersistentSlab_OctagonAboveTreelineWest,
        PersistentSlab_OctagonNearTreelineEast AS o_PersistentSlab_OctagonNearTreelineEast,
        PersistentSlab_OctagonNearTreelineNorth AS o_PersistentSlab_OctagonNearTreelineNorth,
        PersistentSlab_OctagonNearTreelineNorthEast AS o_PersistentSlab_OctagonNearTreelineNorthEast,
        PersistentSlab_OctagonNearTreelineNorthWest AS o_PersistentSlab_OctagonNearTreelineNorthWest,
        PersistentSlab_OctagonNearTreelineSouth AS o_PersistentSlab_OctagonNearTreelineSouth,
        PersistentSlab_OctagonNearTreelineSouthEast AS o_PersistentSlab_OctagonNearTreelineSouthEast,
        PersistentSlab_OctagonNearTreelineSouthWest AS o_PersistentSlab_OctagonNearTreelineSouthWest,
        PersistentSlab_OctagonNearTreelineWest AS o_PersistentSlab_OctagonNearTreelineWest,
        PersistentSlab_OctagonBelowTreelineEast AS o_PersistentSlab_OctagonBelowTreelineEast,
        PersistentSlab_OctagonBelowTreelineNorth AS o_PersistentSlab_OctagonBelowTreelineNorth,
        PersistentSlab_OctagonBelowTreelineNorthEast AS o_PersistentSlab_OctagonBelowTreelineNorthEast,
        PersistentSlab_OctagonBelowTreelineNorthWest AS o_PersistentSlab_OctagonBelowTreelineNorthWest,
        PersistentSlab_OctagonBelowTreelineSouth AS o_PersistentSlab_OctagonBelowTreelineSouth,
        PersistentSlab_OctagonBelowTreelineSouthEast AS o_PersistentSlab_OctagonBelowTreelineSouthEast,
        PersistentSlab_OctagonBelowTreelineSouthWest AS o_PersistentSlab_OctagonBelowTreelineSouthWest,
        PersistentSlab_OctagonBelowTreelineWest AS o_PersistentSlab_OctagonBelowTreelineWest,
        DeepPersistentSlab_Likelihood AS o_DeepPersistentSlab_Likelihood,
        DeepPersistentSlab_MaximumSize AS o_DeepPersistentSlab_MaximumSize,
        DeepPersistentSlab_MinimumSize AS o_DeepPersistentSlab_MinimumSize,
        DeepPersistentSlab_OctagonAboveTreelineEast AS o_DeepPersistentSlab_OctagonAboveTreelineEast,
        DeepPersistentSlab_OctagonAboveTreelineNorth AS o_DeepPersistentSlab_OctagonAboveTreelineNorth,
        DeepPersistentSlab_OctagonAboveTreelineNorthEast AS o_DeepPersistentSlab_OctagonAboveTreelineNorthEast,
        DeepPersistentSlab_OctagonAboveTreelineNorthWest AS o_DeepPersistentSlab_OctagonAboveTreelineNorthWest,
        DeepPersistentSlab_OctagonAboveTreelineSouth AS o_DeepPersistentSlab_OctagonAboveTreelineSouth,
        DeepPersistentSlab_OctagonAboveTreelineSouthEast AS o_DeepPersistentSlab_OctagonAboveTreelineSouthEast,
        DeepPersistentSlab_OctagonAboveTreelineSouthWest AS o_DeepPersistentSlab_OctagonAboveTreelineSouthWest,
        DeepPersistentSlab_OctagonAboveTreelineWest AS o_DeepPersistentSlab_OctagonAboveTreelineWest,
        DeepPersistentSlab_OctagonNearTreelineEast AS o_DeepPersistentSlab_OctagonNearTreelineEast,
        DeepPersistentSlab_OctagonNearTreelineNorth AS o_DeepPersistentSlab_OctagonNearTreelineNorth,
        DeepPersistentSlab_OctagonNearTreelineNorthEast AS o_DeepPersistentSlab_OctagonNearTreelineNorthEast,
        DeepPersistentSlab_OctagonNearTreelineNorthWest AS o_DeepPersistentSlab_OctagonNearTreelineNorthWest,
        DeepPersistentSlab_OctagonNearTreelineSouth AS o_DeepPersistentSlab_OctagonNearTreelineSouth,
        DeepPersistentSlab_OctagonNearTreelineSouthEast AS o_DeepPersistentSlab_OctagonNearTreelineSouthEast,
        DeepPersistentSlab_OctagonNearTreelineSouthWest AS o_DeepPersistentSlab_OctagonNearTreelineSouthWest,
        DeepPersistentSlab_OctagonNearTreelineWest AS o_DeepPersistentSlab_OctagonNearTreelineWest,
        DeepPersistentSlab_OctagonBelowTreelineEast AS o_DeepPersistentSlab_OctagonBelowTreelineEast,
        DeepPersistentSlab_OctagonBelowTreelineNorth AS o_DeepPersistentSlab_OctagonBelowTreelineNorth,
        DeepPersistentSlab_OctagonBelowTreelineNorthEast AS o_DeepPersistentSlab_OctagonBelowTreelineNorthEast,
        DeepPersistentSlab_OctagonBelowTreelineNorthWest AS o_DeepPersistentSlab_OctagonBelowTreelineNorthWest,
        DeepPersistentSlab_OctagonBelowTreelineSouth AS o_DeepPersistentSlab_OctagonBelowTreelineSouth,
        DeepPersistentSlab_OctagonBelowTreelineSouthEast AS o_DeepPersistentSlab_OctagonBelowTreelineSouthEast,
        DeepPersistentSlab_OctagonBelowTreelineSouthWest AS o_DeepPersistentSlab_OctagonBelowTreelineSouthWest,
        DeepPersistentSlab_OctagonBelowTreelineWest AS o_DeepPersistentSlab_OctagonBelowTreelineWest,
        StormSlabs_Likelihood AS o_StormSlabs_Likelihood,
        StormSlabs_MaximumSize AS o_StormSlabs_MaximumSize,
        StormSlabs_MinimumSize AS o_StormSlabs_MinimumSize,
        StormSlabs_OctagonAboveTreelineEast AS o_StormSlabs_OctagonAboveTreelineEast,
        StormSlabs_OctagonAboveTreelineNorth AS o_StormSlabs_OctagonAboveTreelineNorth,
        StormSlabs_OctagonAboveTreelineNorthEast AS o_StormSlabs_OctagonAboveTreelineNorthEast,
        StormSlabs_OctagonAboveTreelineNorthWest AS o_StormSlabs_OctagonAboveTreelineNorthWest,
        StormSlabs_OctagonAboveTreelineSouth AS o_StormSlabs_OctagonAboveTreelineSouth,
        StormSlabs_OctagonAboveTreelineSouthEast AS o_StormSlabs_OctagonAboveTreelineSouthEast,
        StormSlabs_OctagonAboveTreelineSouthWest AS o_StormSlabs_OctagonAboveTreelineSouthWest,
        StormSlabs_OctagonAboveTreelineWest AS o_StormSlabs_OctagonAboveTreelineWest,
        StormSlabs_OctagonNearTreelineEast AS o_StormSlabs_OctagonNearTreelineEast,
        StormSlabs_OctagonNearTreelineNorth AS o_StormSlabs_OctagonNearTreelineNorth,
        StormSlabs_OctagonNearTreelineNorthEast AS o_StormSlabs_OctagonNearTreelineNorthEast,
        StormSlabs_OctagonNearTreelineNorthWest AS o_StormSlabs_OctagonNearTreelineNorthWest,
        StormSlabs_OctagonNearTreelineSouth AS o_StormSlabs_OctagonNearTreelineSouth,
        StormSlabs_OctagonNearTreelineSouthEast AS o_StormSlabs_OctagonNearTreelineSouthEast,
        StormSlabs_OctagonNearTreelineSouthWest AS o_StormSlabs_OctagonNearTreelineSouthWest,
        StormSlabs_OctagonNearTreelineWest AS o_StormSlabs_OctagonNearTreelineWest,
        StormSlabs_OctagonBelowTreelineEast AS o_StormSlabs_OctagonBelowTreelineEast,
        StormSlabs_OctagonBelowTreelineNorth AS o_StormSlabs_OctagonBelowTreelineNorth,
        StormSlabs_OctagonBelowTreelineNorthEast AS o_StormSlabs_OctagonBelowTreelineNorthEast,
        StormSlabs_OctagonBelowTreelineNorthWest AS o_StormSlabs_OctagonBelowTreelineNorthWest,
        StormSlabs_OctagonBelowTreelineSouth AS o_StormSlabs_OctagonBelowTreelineSouth,
        StormSlabs_OctagonBelowTreelineSouthEast AS o_StormSlabs_OctagonBelowTreelineSouthEast,
        StormSlabs_OctagonBelowTreelineSouthWest AS o_StormSlabs_OctagonBelowTreelineSouthWest,
        StormSlabs_OctagonBelowTreelineWest AS o_StormSlabs_OctagonBelowTreelineWest,
        WetSlabs_Likelihood AS o_WetSlabs_Likelihood,
        WetSlabs_MaximumSize AS o_WetSlabs_MaximumSize,
        WetSlabs_MinimumSize AS o_WetSlabs_MinimumSize,
        WetSlabs_OctagonAboveTreelineEast AS o_WetSlabs_OctagonAboveTreelineEast,
        WetSlabs_OctagonAboveTreelineNorth AS o_WetSlabs_OctagonAboveTreelineNorth,
        WetSlabs_OctagonAboveTreelineNorthEast AS o_WetSlabs_OctagonAboveTreelineNorthEast,
        WetSlabs_OctagonAboveTreelineNorthWest AS o_WetSlabs_OctagonAboveTreelineNorthWest,
        WetSlabs_OctagonAboveTreelineSouth AS o_WetSlabs_OctagonAboveTreelineSouth,
        WetSlabs_OctagonAboveTreelineSouthEast AS o_WetSlabs_OctagonAboveTreelineSouthEast,
        WetSlabs_OctagonAboveTreelineSouthWest AS o_WetSlabs_OctagonAboveTreelineSouthWest,
        WetSlabs_OctagonAboveTreelineWest AS o_WetSlabs_OctagonAboveTreelineWest,
        WetSlabs_OctagonNearTreelineEast AS o_WetSlabs_OctagonNearTreelineEast,
        WetSlabs_OctagonNearTreelineNorth AS o_WetSlabs_OctagonNearTreelineNorth,
        WetSlabs_OctagonNearTreelineNorthEast AS o_WetSlabs_OctagonNearTreelineNorthEast,
        WetSlabs_OctagonNearTreelineNorthWest AS o_WetSlabs_OctagonNearTreelineNorthWest,
        WetSlabs_OctagonNearTreelineSouth AS o_WetSlabs_OctagonNearTreelineSouth,
        WetSlabs_OctagonNearTreelineSouthEast AS o_WetSlabs_OctagonNearTreelineSouthEast,
        WetSlabs_OctagonNearTreelineSouthWest AS o_WetSlabs_OctagonNearTreelineSouthWest,
        WetSlabs_OctagonNearTreelineWest AS o_WetSlabs_OctagonNearTreelineWest,
        WetSlabs_OctagonBelowTreelineEast AS o_WetSlabs_OctagonBelowTreelineEast,
        WetSlabs_OctagonBelowTreelineNorth AS o_WetSlabs_OctagonBelowTreelineNorth,
        WetSlabs_OctagonBelowTreelineNorthEast AS o_WetSlabs_OctagonBelowTreelineNorthEast,
        WetSlabs_OctagonBelowTreelineNorthWest AS o_WetSlabs_OctagonBelowTreelineNorthWest,
        WetSlabs_OctagonBelowTreelineSouth AS o_WetSlabs_OctagonBelowTreelineSouth,
        WetSlabs_OctagonBelowTreelineSouthEast AS o_WetSlabs_OctagonBelowTreelineSouthEast,
        WetSlabs_OctagonBelowTreelineSouthWest AS o_WetSlabs_OctagonBelowTreelineSouthWest,
        WetSlabs_OctagonBelowTreelineWest AS o_WetSlabs_OctagonBelowTreelineWest,
        WindSlab_Likelihood AS o_WindSlab_Likelihood,
        WindSlab_MaximumSize AS o_WindSlab_MaximumSize,
        WindSlab_MinimumSize AS o_WindSlab_MinimumSize,
        WindSlab_OctagonAboveTreelineEast AS o_WindSlab_OctagonAboveTreelineEast,
        WindSlab_OctagonAboveTreelineNorth AS o_WindSlab_OctagonAboveTreelineNorth,
        WindSlab_OctagonAboveTreelineNorthEast AS o_WindSlab_OctagonAboveTreelineNorthEast,
        WindSlab_OctagonAboveTreelineNorthWest AS o_WindSlab_OctagonAboveTreelineNorthWest,
        WindSlab_OctagonAboveTreelineSouth AS o_WindSlab_OctagonAboveTreelineSouth,
        WindSlab_OctagonAboveTreelineSouthEast AS o_WindSlab_OctagonAboveTreelineSouthEast,
        WindSlab_OctagonAboveTreelineSouthWest AS o_WindSlab_OctagonAboveTreelineSouthWest,
        WindSlab_OctagonAboveTreelineWest AS o_WindSlab_OctagonAboveTreelineWest,
        WindSlab_OctagonNearTreelineEast AS o_WindSlab_OctagonNearTreelineEast,
        WindSlab_OctagonNearTreelineNorth AS o_WindSlab_OctagonNearTreelineNorth,
        WindSlab_OctagonNearTreelineNorthEast AS o_WindSlab_OctagonNearTreelineNorthEast,
        WindSlab_OctagonNearTreelineNorthWest AS o_WindSlab_OctagonNearTreelineNorthWest,
        WindSlab_OctagonNearTreelineSouth AS o_WindSlab_OctagonNearTreelineSouth,
        WindSlab_OctagonNearTreelineSouthEast AS o_WindSlab_OctagonNearTreelineSouthEast,
        WindSlab_OctagonNearTreelineSouthWest AS o_WindSlab_OctagonNearTreelineSouthWest,
        WindSlab_OctagonNearTreelineWest AS o_WindSlab_OctagonNearTreelineWest,
        WindSlab_OctagonBelowTreelineEast AS o_WindSlab_OctagonBelowTreelineEast,
        WindSlab_OctagonBelowTreelineNorth AS o_WindSlab_OctagonBelowTreelineNorth,
        WindSlab_OctagonBelowTreelineNorthEast AS o_WindSlab_OctagonBelowTreelineNorthEast,
        WindSlab_OctagonBelowTreelineNorthWest AS o_WindSlab_OctagonBelowTreelineNorthWest,
        WindSlab_OctagonBelowTreelineSouth AS o_WindSlab_OctagonBelowTreelineSouth,
        WindSlab_OctagonBelowTreelineSouthEast AS o_WindSlab_OctagonBelowTreelineSouthEast,
        WindSlab_OctagonBelowTreelineSouthWest AS o_WindSlab_OctagonBelowTreelineSouthWest,
        WindSlab_OctagonBelowTreelineWest AS o_WindSlab_OctagonBelowTreelineWest,
        IsCoastalSnowpack AS c_IsCoastalSnowpack,
        IsContenentalSnowpack AS c_IsContenentalSnowpack
    FROM @trainingData AS d
    INNER JOIN @trainingLabels AS l
        ON d.Region == l.UnifiedRegion
        AND d.JoinDate == l.Day1Date;

// CREATE TABLE IF NOT EXISTS dbo.[USWestFullTrainingDataWithLabelsV1.1]
// ( 
//     INDEX idx  
//     CLUSTERED(Date ASC, Lat, Lon)
//     DISTRIBUTED BY RANGE(Date) 
// ) AS SELECT * FROM @joinedData;

// INSERT INTO dbo.[USWestFullTrainingDataWithLablesV1.1]
// SELECT * FROM @renamedColumns;

OUTPUT @joinedData
TO @"/debug-out/V1.1CIAC_UAC_NWAC_FeaturesWithLabels30Days" + @SliceStart + "To" + @SliceEnd + ".csv"
USING Outputters.Csv(quoting : false, dateTimeFormat : null, outputHeader : true);

@auditTrainingData = 
    SELECT
        JoinDate
        ,Lat
        ,Lon
        ,COUNT(*) AS CountOfForecasts
    FROM @joinedData
    GROUP BY JoinDate, Lat, Lon; 

OUTPUT @auditTrainingData
TO @"/audit-out/TrainingFileAudit.csv"
USING Outputters.Csv(quoting : false, dateTimeFormat : null, outputHeader : true);